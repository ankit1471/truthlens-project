{% extends "base.html" %}

{% block title %}Detector{% endblock %}

{% block content %}
    <!-- Styles are now in base.html or a dedicated CSS file for cleaner code -->
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --background-color: #f0f4f8;
            --text-color: #34495e;
            --light-gray: #ecf0f1;
            --white-color: #ffffff;
        }

        .container-main {
            background-color: var(--white-color);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 650px;
            text-align: center;
            margin: auto;
        }

        h1 { color: var(--text-color); margin-bottom: 25px; font-weight: 700; }
        textarea { width: 100%; height: 160px; padding: 15px; border-radius: 8px; border: 2px solid var(--light-gray); margin-bottom: 20px; box-sizing: border-box; font-size: 16px; }
        textarea:focus { outline: none; border-color: var(--primary-color); }
        .main-btn { background: linear-gradient(45deg, #3498db, #2980b9); color: var(--white-color); padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: 600; width: 100%; }
        
        /* RESULT CARD STYLING */
        .result-card { margin-top: 30px; padding: 30px; border-radius: 12px; text-align: left; }
        .result-card.real { background-color: #e8f8f2; border: 2px solid var(--success-color); }
        .result-card.fake { background-color: #fdedec; border: 2px solid var(--error-color); }
        .result-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; text-align: center; }
        .result-card.real .result-title { color: var(--success-color); }
        .result-card.fake .result-title { color: var(--error-color); }
        .original-text p { margin: 0; font-size: 14px; color: #7f8c8d; max-height: 80px; overflow-y: auto; background-color: #f8f9fa; padding: 10px; border-radius: 5px; }
        .feedback-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--light-gray); text-align: center; }
        .feedback-btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 0 5px; }
        .btn-correct { background-color: var(--success-color); color: white; }
        .btn-incorrect { background-color: var(--error-color); color: white; }
    </style>

    <div class="container-main">
        <!-- FORM TO SUBMIT NEWS -->
        <h1>TruthLens Detector</h1>
        <p>Welcome, {{ current_user.username }}! Enter the news text below to analyze.</p>
        <form action="{{ url_for('predict') }}" method="POST">
            <textarea name="news_text" placeholder="Enter the news article, headline, or text here..." required></textarea>
            <br>
            <button type="submit" class="main-btn">Analyze News</button>
        </form>

        <!-- RESULT AND FEEDBACK SECTION (DYNAMICALLY SHOWN) -->
        {% if prediction_result %}
        <div class="result-card {% if prediction_result == 'REAL' %}real{% else %}fake{% endif %}">
            <h2 class="result-title">This News Appears to be {{ prediction_result }}</h2>
            
            <div class="original-text">
                <strong>Analyzed Text:</strong>
                <p>"{{ news_text }}"</p>
            </div>

            <div class="feedback-section">
                {% if feedback_submitted %}
                    <p class="text-success fw-bold">Thank you for your feedback!</p>
                {% else %}
                    <p>Was this prediction correct?</p>
                    <form action="{{ url_for('feedback') }}" method="POST">
                        <!-- Hidden fields to remember the context -->
                        <input type="hidden" name="article_id" value="{{ article_id }}">
                        <input type="hidden" name="original_text" value="{{ news_text }}">
                        <input type="hidden" name="original_prediction" value="{{ prediction_result }}">
                        
                        <button type="submit" name="feedback" value="correct" class="feedback-btn btn-correct">üëç Yes, Correct</button>
                        <button type="submit" name="feedback" value="incorrect" class="feedback-btn btn-incorrect">üëé No, Incorrect</button>
                    </form>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div> 
{% endblock %}